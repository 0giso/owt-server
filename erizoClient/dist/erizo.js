var CryptoJS=CryptoJS||function(d,a){var b={},c=b.lib={},f=function(){},h=c.Base={extend:function(a){f.prototype=this;var c=new f;a&&c.mixIn(a);c.$super=this;return c},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.$super.extend(this)}},e=c.WordArray=h.extend({init:function(c,e){c=this.words=c||[];this.sigBytes=
e!=a?e:4*c.length},toString:function(a){return(a||j).stringify(this)},concat:function(a){var c=this.words,e=a.words,b=this.sigBytes,a=a.sigBytes;this.clamp();if(b%4)for(var g=0;g<a;g++)c[b+g>>>2]|=(e[g>>>2]>>>24-8*(g%4)&255)<<24-8*((b+g)%4);else if(65535<e.length)for(g=0;g<a;g+=4)c[b+g>>>2]=e[g>>>2];else c.push.apply(c,e);this.sigBytes+=a;return this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<32-8*(c%4);a.length=d.ceil(c/4)},clone:function(){var a=h.clone.call(this);
a.words=this.words.slice(0);return a},random:function(a){for(var c=[],b=0;b<a;b+=4)c.push(4294967296*d.random()|0);return e.create(c,a)}}),i=b.enc={},j=i.Hex={stringify:function(a){for(var c=a.words,a=a.sigBytes,e=[],b=0;b<a;b++){var g=c[b>>>2]>>>24-8*(b%4)&255;e.push((g>>>4).toString(16));e.push((g&15).toString(16))}return e.join("")},parse:function(a){for(var c=a.length,b=[],g=0;g<c;g+=2)b[g>>>3]|=parseInt(a.substr(g,2),16)<<24-4*(g%8);return e.create(b,c/2)}},g=i.Latin1={stringify:function(a){for(var c=
a.words,a=a.sigBytes,e=[],b=0;b<a;b++)e.push(String.fromCharCode(c[b>>>2]>>>24-8*(b%4)&255));return e.join("")},parse:function(a){for(var c=a.length,b=[],g=0;g<c;g++)b[g>>>2]|=(a.charCodeAt(g)&255)<<24-8*(g%4);return e.create(b,c)}},n=i.Utf8={stringify:function(a){try{return decodeURIComponent(escape(g.stringify(a)))}catch(c){throw Error("Malformed UTF-8 data");}},parse:function(a){return g.parse(unescape(encodeURIComponent(a)))}},l=c.BufferedBlockAlgorithm=h.extend({reset:function(){this._data=e.create();
this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=n.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(a){var c=this._data,b=c.words,g=c.sigBytes,i=this.blockSize,f=g/(4*i),f=a?d.ceil(f):d.max((f|0)-this._minBufferSize,0),a=f*i,g=d.min(4*a,g);if(a){for(var h=0;h<a;h+=i)this._doProcessBlock(b,h);h=b.splice(0,a);c.sigBytes-=g}return e.create(h,g)},clone:function(){var a=h.clone.call(this);a._data=this._data.clone();return a},_minBufferSize:0});c.Hasher=l.extend({init:function(){this.reset()},
reset:function(){l.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);this._doFinalize();return this._hash},clone:function(){var a=l.clone.call(this);a._hash=this._hash.clone();return a},blockSize:16,_createHelper:function(a){return function(c,e){return a.create(e).finalize(c)}},_createHmacHelper:function(a){return function(c,e){return q.HMAC.create(a,e).finalize(c)}}});var q=b.algo={};return b}(Math);
(function(){var d=CryptoJS,a=d.lib,b=a.WordArray,a=a.Hasher,c=[],f=d.algo.SHA1=a.extend({_doReset:function(){this._hash=b.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(a,e){for(var b=this._hash.words,d=b[0],g=b[1],f=b[2],l=b[3],q=b[4],o=0;80>o;o++){if(16>o)c[o]=a[e+o]|0;else{var p=c[o-3]^c[o-8]^c[o-14]^c[o-16];c[o]=p<<1|p>>>31}p=(d<<5|d>>>27)+q+c[o];p=20>o?p+((g&f|~g&l)+1518500249):40>o?p+((g^f^l)+1859775393):60>o?p+((g&f|g&l|f&l)-1894007588):p+((g^f^l)-
899497514);q=l;l=f;f=g<<30|g>>>2;g=d;d=p}b[0]=b[0]+d|0;b[1]=b[1]+g|0;b[2]=b[2]+f|0;b[3]=b[3]+l|0;b[4]=b[4]+q|0},_doFinalize:function(){var a=this._data,c=a.words,b=8*this._nDataBytes,d=8*a.sigBytes;c[d>>>5]|=128<<24-d%32;c[(d+64>>>9<<4)+15]=b;a.sigBytes=4*c.length;this._process()}});d.SHA1=a._createHelper(f);d.HmacSHA1=a._createHmacHelper(f)})();
(function(){var d=CryptoJS,a=d.enc.Utf8;d.algo.HMAC=d.lib.Base.extend({init:function(b,c){b=this._hasher=b.create();"string"==typeof c&&(c=a.parse(c));var d=b.blockSize,h=4*d;c.sigBytes>h&&(c=b.finalize(c));for(var e=this._oKey=c.clone(),i=this._iKey=c.clone(),j=e.words,g=i.words,n=0;n<d;n++)j[n]^=1549556828,g[n]^=909522486;e.sigBytes=i.sigBytes=h;this.reset()},reset:function(){var a=this._hasher;a.reset();a.update(this._iKey)},update:function(a){this._hasher.update(a);return this},finalize:function(a){var c=
this._hasher,a=c.finalize(a);c.reset();return c.finalize(this._oKey.clone().concat(a))}})})();var N=N||{};N.authors=["aalonsog@dit.upm.es","prodriguez@dit.upm.es","jcervino@dit.upm.es"];N.version=0.1;N=N||{};
N.Base64=function(){var d,a,b,c,f,h,e,i,j;d="A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,0,1,2,3,4,5,6,7,8,9,+,/".split(",");a=[];for(f=0;f<d.length;f+=1)a[d[f]]=f;h=function(a){b=a;c=0};e=function(){var a;if(!b||c>=b.length)return-1;a=b.charCodeAt(c)&255;c+=1;return a};i=function(){if(!b)return-1;for(;!(c>=b.length);){var e=b.charAt(c);c+=1;if(a[e])return a[e];if("A"===e)return 0}return-1};j=function(a){a=a.toString(16);1===a.length&&(a=
"0"+a);return unescape("%"+a)};return{encodeBase64:function(a){var c,b,i;h(a);a="";c=Array(3);b=0;for(i=!1;!i&&-1!==(c[0]=e());)if(c[1]=e(),c[2]=e(),a+=d[c[0]>>2],-1!==c[1]?(a+=d[c[0]<<4&48|c[1]>>4],-1!==c[2]?(a+=d[c[1]<<2&60|c[2]>>6],a+=d[c[2]&63]):(a+=d[c[1]<<2&60],a+="=",i=!0)):(a+=d[c[0]<<4&48],a+="=",a+="=",i=!0),b+=4,76<=b)a+="\n",b=0;return a},decodeBase64:function(a){var c,e;h(a);a="";c=Array(4);for(e=!1;!e&&-1!==(c[0]=i())&&-1!==(c[1]=i());)c[2]=i(),c[3]=i(),a+=j(c[0]<<2&255|c[1]>>4),-1!==
c[2]?(a+=j(c[1]<<4&255|c[2]>>2),-1!==c[3]?a+=j(c[2]<<6&255|c[3]):e=!0):e=!0;return a}}}(N);N=N||{};
N.API=function(d){var a,b;a=function(a,f,h,e,i,j){var g,n,l,q,o,p;g=d.API.params.service;n=d.API.params.key;""===g||""===n?console.log("ServiceID and Key are required!!"):(l=(new Date).getTime(),q=l+",123123aaff",o="MAuth realm=http://marte3.dit.upm.es,mauth_signature_method=HMAC_SHA1",""!==i&&""!==j&&(o=o+",mauth_username="+i+",mauth_role="+j,q+=","+i+","+j),i=b(q,n),o=o+",mauth_serviceid="+g+",mauth_cnonce=123123aaff,mauth_timestamp="+l+",mauth_signature="+i,p=new XMLHttpRequest,p.onreadystatechange=
function(){4===p.readyState&&a(p.responseText)},p.open(f,e,!0),p.setRequestHeader("Authorization",o),p.setRequestHeader("Content-Type","application/json"),console.log("Sending "+f+" to "+e),p.send(JSON.stringify(h)))};b=function(a,b){var h;h=CryptoJS.HmacSHA1(a,b).toString(CryptoJS.enc.Hex);return d.Base64.encodeBase64(h)};return{params:{url:void 0,service:void 0,key:void 0},init:function(a,b,h){d.API.params.url=a;d.API.params.service=b;d.API.params.key=h},createRoom:function(c,b){a(b,"POST",c,d.API.params.url+
"rooms")},getRooms:function(c){a(c,"GET",void 0,d.API.params.url+"rooms")},deleteRoom:function(c,b){a(b,"DELETE",void 0,d.API.params.url+"rooms/"+c)},createToken:function(c,b,h,e){a(e,"POST",void 0,d.API.params.url+"rooms/"+c+"/tokens",b,h)},createService:function(c,b,h){a(h,"POST",{name:c,key:b},d.API.params.url+"services/")},getServices:function(c){a(c,"GET",void 0,d.API.params.url+"services/")},getService:function(c,b){a(b,"GET",void 0,d.API.params.url+"services/"+c)},deleteService:function(c,
b){a(b,"DELETE",void 0,d.API.params.url+"services/"+c)},getUsers:function(c,b){a(b,"GET",void 0,d.API.params.url+"rooms/"+c+"/users/")},getUser:function(c,b,h){a(h,"GET",void 0,d.API.params.url+"rooms/"+c+"/users/"+b)},deleteUser:function(c,b,h){a(h,"DELETE",void 0,d.API.params.url+"rooms/"+c+"/users/"+b)}}}(N);RoapConnection.sessionId=103;RoapConnection.JsepPeerConnectionConstructor=webkitPeerConnection00;RoapConnection.SessionDescriptionConstructor=SessionDescription;
function RoapConnection(d,a){var b=this;this.peerConnection=new RoapConnection.JsepPeerConnectionConstructor("STUN stun.l.google.com:19302",function(a,d){!1==d&&(b.moreIceComing=!1,b.markActionNeeded());b.iceCandidateCount+=1});this.sessionId=++RoapConnection.sessionId;this.sequenceNumber=0;this.iceStarted=this.actionNeeded=!1;this.moreIceComing=!0;this.iceCandidateCount=0;this.onsignalingmessage=a;this.peerConnection.onopen=function(){if(b.onopen)b.onopen()};this.peerConnection.onaddstream=function(a){if(b.onaddstream)b.onaddstream(a)};
this.peerConnection.onremovestream=function(a){if(b.onremovestream)b.onremovestream(a)};this.onremovestream=this.onaddstream=null;this.state="new";this.markActionNeeded()}
RoapConnection.prototype.processSignalingMessage=function(d){console.log("Activity on conn "+this.sessionId);this.incomingMessage=d=JSON.parse(d);"new"===this.state?"OFFER"===d.messageType?(this.offer_as_string=d.sdp,this.peerConnection.setRemoteDescription(this.peerConnection.SDP_OFFER,new RoapConnection.SessionDescriptionConstructor(d.sdp)),this.state="offer-received",this.markActionNeeded()):this.error("Illegal message for this state: "+d.messageType+" in state "+this.state):"offer-sent"===this.state?
"ANSWER"===d.messageType?(this.peerConnection.setRemoteDescription(this.peerConnection.SDP_ANSWER,new RoapConnection.SessionDescriptionConstructor(d.sdp)),this.sendOK(),this.state="established"):"pr-answer"===d.messageType?this.peerConnection.setRemoteDescription("pr-answer",new RoapConnection.SessionDescriptionConstructor(d.sdp)):"offer"===d.messageType?this.error("Not written yet"):this.error("Illegal message for this state: "+d.messageType+" in state "+this.state):"established"===this.state&&("OFFER"===
d.messageType?(this.peerConnection.setRemoteDescription(this.peerConnection.SDP_OFFER,new RoapConnection.SessionDescriptionConstructor(d.sdp)),this.state="offer-received",this.markActionNeeded()):this.error("Illegal message for this state: "+d.messageType+" in state "+this.state))};RoapConnection.prototype.addStream=function(d){this.peerConnection.addStream(d);this.markActionNeeded()};
RoapConnection.prototype.removeStream=function(d){var a;for(a=0;a<this.peerConnection.localStreams.length;++a)localStreams[a]===d&&(localStreams[a]=null);this.markActionNeeded()};RoapConnection.prototype.close=function(){this.state="closed";this.peerConnection.close()};RoapConnection.prototype.markActionNeeded=function(){this.actionNeeded=!0;var d=this;this.doLater(function(){d.onstablestate()})};RoapConnection.prototype.doLater=function(d){window.setTimeout(d,1)};
RoapConnection.prototype.onstablestate=function(){var d;if(this.actionNeeded){if("new"===this.state||"established"===this.state){d=this.peerConnection.createOffer({has_audio:!0,has_video:!0});if(d.toSdp()!=this.prevOffer){this.peerConnection.setLocalDescription(this.peerConnection.SDP_OFFER,d);this.peerConnection.startIce();this.state="preparing-offer";this.markActionNeeded();return}console.log("Not sending a new offer")}else if("preparing-offer"===this.state){if(this.moreIceComing)return;this.prevOffer=
this.peerConnection.localDescription.toSdp();this.sendMessage("OFFER",this.prevOffer);this.state="offer-sent"}else if("offer-received"===this.state){d=this.peerConnection.createAnswer(this.offer_as_string,{has_audio:!0,has_video:!0});this.peerConnection.setLocalDescription(this.peerConnection.SDP_ANSWER,d);this.state="offer-received-preparing-answer";if(this.iceStarted){this.markActionNeeded();return}console.log((new Date).getTime()+": Starting ICE in responder");this.peerConnection.startIce();this.iceStarted=
!0}else if("offer-received-preparing-answer"===this.state){if(this.moreIceComing)return;d=this.peerConnection.localDescription;this.sendMessage("ANSWER",d.toSdp());this.state="established"}else this.error("Dazed and confused in state "+this.state+", stopping here");this.actionNeeded=!1}};RoapConnection.prototype.sendOK=function(){this.sendMessage("OK")};
RoapConnection.prototype.sendMessage=function(d,a){var b={};b.messageType=d;b.sdp=a;"OFFER"===d?(b.offererSessionId=this.sessionId,b.answererSessionId=this.otherSessionId,b.seq=++this.sequenceNumber,b.tiebreaker=Math.floor(429496723*Math.random()+1)):(b.offererSessionId=this.incomingMessage.offererSessionId,b.answererSessionId=this.sessionId,b.seq=this.incomingMessage.seq);this.onsignalingmessage(JSON.stringify(b))};RoapConnection.prototype.error=function(d){throw"Error in RoapOnJsep: "+d;};(function(d,a){d.version="0.9.6";d.protocol=1;d.transports=[];d.j=[];d.sockets={};d.connect=function(b,c){var f=d.util.parseUri(b),h,e;a&&a.location&&(f.protocol=f.protocol||a.location.protocol.slice(0,-1),f.host=f.host||(a.document?a.document.domain:a.location.hostname),f.port=f.port||a.location.port);h=d.util.uniqueUri(f);var i={host:f.host,secure:"https"==f.protocol,port:f.port||("https"==f.protocol?443:80),query:f.query||""};d.util.merge(i,c);if(i["force new connection"]||!d.sockets[h])e=new d.Socket(i);
!i["force new connection"]&&e&&(d.sockets[h]=e);e=e||d.sockets[h];return e.of(1<f.path.length?f.path:"")}})("object"===typeof module?module.exports:this.io={},this);
(function(d,a){var b=d.util={},c=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,f="source,protocol,authority,userInfo,user,password,host,port,relative,path,directory,file,query,anchor".split(",");b.parseUri=function(a){for(var a=c.exec(a||""),b={},d=14;d--;)b[f[d]]=a[d]||"";return b};b.uniqueUri=function(c){var b=c.protocol,d=c.host,c=c.port;"document"in
a?(d=d||document.domain,c=c||("https"==b&&"https:"!==document.location.protocol?443:document.location.port)):(d=d||"localhost",!c&&"https"==b&&(c=443));return(b||"http")+"://"+d+":"+(c||80)};b.query=function(a,c){var d=b.chunkQuery(a||""),g=[];b.merge(d,b.chunkQuery(c||""));for(var h in d)d.hasOwnProperty(h)&&g.push(h+"="+d[h]);return g.length?"?"+g.join("&"):""};b.chunkQuery=function(a){for(var c={},a=a.split("&"),b=0,d=a.length,h;b<d;++b)h=a[b].split("="),h[0]&&(c[h[0]]=h[1]);return c};var h=!1;
b.load=function(c){if("document"in a&&"complete"===document.readyState||h)return c();b.on(a,"load",c,!1)};b.on=function(a,c,b,d){a.attachEvent?a.attachEvent("on"+c,b):a.addEventListener&&a.addEventListener(c,b,d)};b.request=function(a){if(a&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!a||b.ua.hasCORS))return new XMLHttpRequest;if(!a)try{return new (window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(c){}return null};"undefined"!=
typeof window&&b.load(function(){h=!0});b.defer=function(a){if(!b.ua.webkit||"undefined"!=typeof importScripts)return a();b.load(function(){setTimeout(a,100)})};b.merge=function(a,c,d,g){var g=g||[],d="undefined"==typeof d?2:d,h;for(h in c)c.hasOwnProperty(h)&&0>b.indexOf(g,h)&&("object"!==typeof a[h]||!d?(a[h]=c[h],g.push(c[h])):b.merge(a[h],c[h],d-1,g));return a};b.mixin=function(a,c){b.merge(a.prototype,c.prototype)};b.inherit=function(a,c){function b(){}b.prototype=c.prototype;a.prototype=new b};
b.isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};b.intersect=function(a,c){for(var d=[],g=a.length>c.length?a:c,h=a.length>c.length?c:a,f=0,q=h.length;f<q;f++)~b.indexOf(g,h[f])&&d.push(h[f]);return d};b.indexOf=function(a,c,b){for(var d=a.length,b=0>b?0>b+d?0:b+d:b||0;b<d&&a[b]!==c;b++);return d<=b?-1:b};b.toArray=function(a){for(var c=[],b=0,d=a.length;b<d;b++)c.push(a[b]);return c};b.ua={};b.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var a=
new XMLHttpRequest}catch(c){return!1}return void 0!=a.withCredentials}();b.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent)})("undefined"!=typeof io?io:module.exports,this);
(function(d,a){function b(){}d.EventEmitter=b;b.prototype.on=function(c,b){this.$events||(this.$events={});this.$events[c]?a.util.isArray(this.$events[c])?this.$events[c].push(b):this.$events[c]=[this.$events[c],b]:this.$events[c]=b;return this};b.prototype.addListener=b.prototype.on;b.prototype.once=function(a,b){function d(){e.removeListener(a,d);b.apply(this,arguments)}var e=this;d.listener=b;this.on(a,d);return this};b.prototype.removeListener=function(c,b){if(this.$events&&this.$events[c]){var d=
this.$events[c];if(a.util.isArray(d)){for(var e=-1,i=0,j=d.length;i<j;i++)if(d[i]===b||d[i].listener&&d[i].listener===b){e=i;break}if(0>e)return this;d.splice(e,1);d.length||delete this.$events[c]}else(d===b||d.listener&&d.listener===b)&&delete this.$events[c]}return this};b.prototype.removeAllListeners=function(a){this.$events&&this.$events[a]&&(this.$events[a]=null);return this};b.prototype.listeners=function(c){this.$events||(this.$events={});this.$events[c]||(this.$events[c]=[]);a.util.isArray(this.$events[c])||
(this.$events[c]=[this.$events[c]]);return this.$events[c]};b.prototype.emit=function(c){if(!this.$events)return!1;var b=this.$events[c];if(!b)return!1;var d=Array.prototype.slice.call(arguments,1);if("function"==typeof b)b.apply(this,d);else if(a.util.isArray(b))for(var b=b.slice(),e=0,i=b.length;e<i;e++)b[e].apply(this,d);else return!1;return!0}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);
(function(d,a){function b(a){return 10>a?"0"+a:a}function c(a){i.lastIndex=0;return i.test(a)?'"'+a.replace(i,function(a){var c=n[a];return"string"===typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function f(a,d){var e,h,i,n,r=j,t,s=d[a];s instanceof Date&&(s=isFinite(a.valueOf())?a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1)+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())+"Z":null);"function"===typeof l&&(s=l.call(d,a,
s));switch(typeof s){case "string":return c(s);case "number":return isFinite(s)?""+s:"null";case "boolean":case "null":return""+s;case "object":if(!s)return"null";j+=g;t=[];if("[object Array]"===Object.prototype.toString.apply(s)){n=s.length;for(e=0;e<n;e+=1)t[e]=f(e,s)||"null";i=0===t.length?"[]":j?"[\n"+j+t.join(",\n"+j)+"\n"+r+"]":"["+t.join(",")+"]";j=r;return i}if(l&&"object"===typeof l){n=l.length;for(e=0;e<n;e+=1)"string"===typeof l[e]&&(h=l[e],(i=f(h,s))&&t.push(c(h)+(j?": ":":")+i))}else for(h in s)Object.prototype.hasOwnProperty.call(s,
h)&&(i=f(h,s))&&t.push(c(h)+(j?": ":":")+i);i=0===t.length?"{}":j?"{\n"+j+t.join(",\n"+j)+"\n"+r+"}":"{"+t.join(",")+"}";j=r;return i}}if(a&&a.parse)return d.JSON={parse:a.parse,stringify:a.stringify};var h=d.JSON={},e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,i=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,j,g,n={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f",
"\r":"\\r",'"':'\\"',"\\":"\\\\"},l;h.stringify=function(a,c,b){var d;g=j="";if("number"===typeof b)for(d=0;d<b;d+=1)g+=" ";else"string"===typeof b&&(g=b);if((l=c)&&"function"!==typeof c&&("object"!==typeof c||"number"!==typeof c.length))throw Error("JSON.stringify");return f("",{"":a})};h.parse=function(a,c){function b(a,d){var e,g,h=a[d];if(h&&"object"===typeof h)for(e in h)Object.prototype.hasOwnProperty.call(h,e)&&(g=b(h,e),void 0!==g?h[e]=g:delete h[e]);return c.call(a,d,h)}var d,a=""+a;e.lastIndex=
0;e.test(a)&&(a=a.replace(e,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return d=eval("("+a+")"),"function"===typeof c?b({"":d},""):d;throw new SyntaxError("JSON.parse");}})("undefined"!=typeof io?io:module.exports,"undefined"!==typeof JSON?JSON:void 0);
(function(d,a){var b=d.parser={},c=b.packets="disconnect,connect,heartbeat,message,json,event,ack,error,noop".split(","),f=b.reasons=["transport not supported","client not handshaken","unauthorized"],h=b.advice=["reconnect"],e=a.JSON,i=a.util.indexOf;b.encodePacket=function(a){var b=i(c,a.type),d=a.id||"",j=a.endpoint||"",o=a.ack,p=null;switch(a.type){case "error":var A=a.reason?i(f,a.reason):"",a=a.advice?i(h,a.advice):"";if(""!==A||""!==a)p=A+(""!==a?"+"+a:"");break;case "message":""!==a.data&&
(p=a.data);break;case "event":p={name:a.name};a.args&&a.args.length&&(p.args=a.args);p=e.stringify(p);break;case "json":p=e.stringify(a.data);break;case "connect":a.qs&&(p=a.qs);break;case "ack":p=a.ackId+(a.args&&a.args.length?"+"+e.stringify(a.args):"")}b=[b,d+("data"==o?"+":""),j];null!==p&&void 0!==p&&b.push(p);return b.join(":")};b.encodePayload=function(a){var c="";if(1==a.length)return a[0];for(var b=0,d=a.length;b<d;b++)c+="\ufffd"+a[b].length+"\ufffd"+a[b];return c};var j=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;
b.decodePacket=function(a){var b=a.match(j);if(!b)return{};var d=b[2]||"",a=b[5]||"",i={type:c[b[1]],endpoint:b[4]||""};d&&(i.id=d,i.ack=b[3]?"data":!0);switch(i.type){case "error":b=a.split("+");i.reason=f[b[0]]||"";i.advice=h[b[1]]||"";break;case "message":i.data=a||"";break;case "event":try{var o=e.parse(a);i.name=o.name;i.args=o.args}catch(p){}i.args=i.args||[];break;case "json":try{i.data=e.parse(a)}catch(A){}break;case "connect":i.qs=a||"";break;case "ack":if(b=a.match(/^([0-9]+)(\+)?(.*)/))if(i.ackId=
b[1],i.args=[],b[3])try{i.args=b[3]?e.parse(b[3]):[]}catch(w){}}return i};b.decodePayload=function(a){if("\ufffd"==a.charAt(0)){for(var c=[],d=1,e="";d<a.length;d++)"\ufffd"==a.charAt(d)?(c.push(b.decodePacket(a.substr(d+1).substr(0,e))),d+=Number(e)+1,e=""):e+=a.charAt(d);return c}return[b.decodePacket(a)]}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);
(function(d,a){function b(a,b){this.socket=a;this.sessid=b}d.Transport=b;a.util.mixin(b,a.EventEmitter);b.prototype.onData=function(c){this.clearCloseTimeout();(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout();if(""!==c&&(c=a.parser.decodePayload(c))&&c.length)for(var b=0,d=c.length;b<d;b++)this.onPacket(c[b]);return this};b.prototype.onPacket=function(a){this.socket.setHeartbeatTimeout();if("heartbeat"==a.type)return this.onHeartbeat();if("connect"==
a.type&&""==a.endpoint)this.onConnect();"error"==a.type&&"reconnect"==a.advice&&(this.open=!1);this.socket.onPacket(a);return this};b.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var a=this;this.closeTimeout=setTimeout(function(){a.onDisconnect()},this.socket.closeTimeout)}};b.prototype.onDisconnect=function(){this.close&&this.open&&this.close();this.clearTimeouts();this.socket.onDisconnect();return this};b.prototype.onConnect=function(){this.socket.onConnect();return this};b.prototype.clearCloseTimeout=
function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)};b.prototype.clearTimeouts=function(){this.clearCloseTimeout();this.reopenTimeout&&clearTimeout(this.reopenTimeout)};b.prototype.packet=function(b){this.send(a.parser.encodePacket(b))};b.prototype.onHeartbeat=function(){this.packet({type:"heartbeat"})};b.prototype.onOpen=function(){this.open=!0;this.clearCloseTimeout();this.socket.onOpen()};b.prototype.onClose=function(){this.open=!1;this.socket.onClose();this.onDisconnect()};
b.prototype.prepareUrl=function(){var b=this.socket.options;return this.scheme()+"://"+b.host+":"+b.port+"/"+b.resource+"/"+a.protocol+"/"+this.name+"/"+this.sessid};b.prototype.ready=function(a,b){b.call(this)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);
(function(d,a,b){function c(c){this.options={port:80,secure:!1,document:"document"in b?document:!1,resource:"socket.io",transports:a.transports,"connect timeout":1E4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":Infinity,"reopen delay":3E3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843};a.util.merge(this.options,c);this.reconnecting=this.connecting=this.open=this.connected=!1;this.namespaces={};this.buffer=
[];this.doBuffer=!1;if(this.options["sync disconnect on unload"]&&(!this.isXDomain()||a.util.ua.hasCORS)){var d=this;a.util.on(b,"unload",function(){d.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function f(){}d.Socket=c;a.util.mixin(c,a.EventEmitter);c.prototype.of=function(b){this.namespaces[b]||(this.namespaces[b]=new a.SocketNamespace(this,b),""!==b&&this.namespaces[b].packet({type:"connect"}));return this.namespaces[b]};c.prototype.publish=function(){this.emit.apply(this,
arguments);var a,b;for(b in this.namespaces)this.namespaces.hasOwnProperty(b)&&(a=this.of(b),a.$emit.apply(a,arguments))};c.prototype.handshake=function(b){function c(a){if(a instanceof Error)d.onError(a.message);else b.apply(null,a.split(":"))}var d=this,j=this.options,j=["http"+(j.secure?"s":"")+":/",j.host+":"+j.port,j.resource,a.protocol,a.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!a.util.ua.hasCORS){var g=document.getElementsByTagName("script")[0],n=document.createElement("script");
n.src=j+"&jsonp="+a.j.length;g.parentNode.insertBefore(n,g);a.j.push(function(a){c(a);n.parentNode.removeChild(n)})}else{var l=a.util.request();l.open("GET",j,!0);l.withCredentials=!0;l.onreadystatechange=function(){4==l.readyState&&(l.onreadystatechange=f,200==l.status?c(l.responseText):!d.reconnecting&&d.onError(l.responseText))};l.send(null)}};c.prototype.getTransport=function(b){for(var b=b||this.transports,c=0,d;d=b[c];c++)if(a.Transport[d]&&a.Transport[d].check(this)&&(!this.isXDomain()||a.Transport[d].xdomainCheck()))return new a.Transport[d](this,
this.sessionid);return null};c.prototype.connect=function(b){if(this.connecting)return this;var c=this;this.handshake(function(d,f,g,n){function l(a){c.transport&&c.transport.clearTimeouts();c.transport=c.getTransport(a);if(!c.transport)return c.publish("connect_failed");c.transport.ready(c,function(){c.connecting=!0;c.publish("connecting",c.transport.name);c.transport.open();c.options["connect timeout"]&&(c.connectTimeoutTimer=setTimeout(function(){if(!c.connected&&(c.connecting=!1,c.options["try multiple transports"])){c.remainingTransports||
(c.remainingTransports=c.transports.slice(0));for(var a=c.remainingTransports;0<a.length&&a.splice(0,1)[0]!=c.transport.name;);a.length?l(a):c.publish("connect_failed")}},c.options["connect timeout"]))})}c.sessionid=d;c.closeTimeout=1E3*g;c.heartbeatTimeout=1E3*f;c.transports=n?a.util.intersect(n.split(","),c.options.transports):c.options.transports;c.setHeartbeatTimeout();l(c.transports);c.once("connect",function(){clearTimeout(c.connectTimeoutTimer);b&&"function"==typeof b&&b()})});return this};
c.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);var a=this;this.heartbeatTimeoutTimer=setTimeout(function(){a.transport.onClose()},this.heartbeatTimeout)};c.prototype.packet=function(a){this.connected&&!this.doBuffer?this.transport.packet(a):this.buffer.push(a);return this};c.prototype.setBuffer=function(a){this.doBuffer=a;!a&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])};c.prototype.disconnect=function(){if(this.connected||
this.connecting)this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted");return this};c.prototype.disconnectSync=function(){a.util.request().open("GET",this.resource+"/"+a.protocol+"/"+this.sessionid,!0);this.onDisconnect("booted")};c.prototype.isXDomain=function(){var a=b.location.port||("https:"==b.location.protocol?443:80);return this.options.host!==b.location.hostname||this.options.port!=a};c.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=
!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))};c.prototype.onOpen=function(){this.open=!0};c.prototype.onClose=function(){this.open=!1;clearTimeout(this.heartbeatTimeoutTimer)};c.prototype.onPacket=function(a){this.of(a.endpoint).onPacket(a)};c.prototype.onError=function(a){if(a&&a.advice&&"reconnect"===a.advice&&(this.connected||this.connecting))this.disconnect(),this.options.reconnect&&this.reconnect();this.publish("error",a&&a.reason?a.reason:a)};c.prototype.onDisconnect=function(a){var c=
this.connected,b=this.connecting;this.open=this.connecting=this.connected=!1;if(c||b)this.transport.close(),this.transport.clearTimeouts(),c&&(this.publish("disconnect",a),"booted"!=a&&this.options.reconnect&&!this.reconnecting&&this.reconnect())};c.prototype.reconnect=function(){function a(){if(b.connected){for(var d in b.namespaces)b.namespaces.hasOwnProperty(d)&&""!==d&&b.namespaces[d].packet({type:"connect"});b.publish("reconnect",b.transport.name,b.reconnectionAttempts)}clearTimeout(b.reconnectionTimer);
b.removeListener("connect_failed",c);b.removeListener("connect",c);b.reconnecting=!1;delete b.reconnectionAttempts;delete b.reconnectionDelay;delete b.reconnectionTimer;delete b.redoTransports;b.options["try multiple transports"]=g}function c(){if(b.reconnecting){if(b.connected)return a();if(b.connecting&&b.reconnecting)return b.reconnectionTimer=setTimeout(c,1E3);b.reconnectionAttempts++>=d?b.redoTransports?(b.publish("reconnect_failed"),a()):(b.on("connect_failed",c),b.options["try multiple transports"]=
!0,b.transport=b.getTransport(),b.redoTransports=!0,b.connect()):(b.reconnectionDelay<f&&(b.reconnectionDelay*=2),b.connect(),b.publish("reconnecting",b.reconnectionDelay,b.reconnectionAttempts),b.reconnectionTimer=setTimeout(c,b.reconnectionDelay))}}this.reconnecting=!0;this.reconnectionAttempts=0;this.reconnectionDelay=this.options["reconnection delay"];var b=this,d=this.options["max reconnection attempts"],g=this.options["try multiple transports"],f=this.options["reconnection limit"];this.options["try multiple transports"]=
!1;this.reconnectionTimer=setTimeout(c,this.reconnectionDelay);this.on("connect",c)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);
(function(d,a){function b(a,b){this.socket=a;this.name=b||"";this.flags={};this.json=new c(this,"json");this.ackPackets=0;this.acks={}}function c(a,b){this.namespace=a;this.name=b}d.SocketNamespace=b;a.util.mixin(b,a.EventEmitter);b.prototype.$emit=a.EventEmitter.prototype.emit;b.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)};b.prototype.packet=function(a){a.endpoint=this.name;this.socket.packet(a);this.flags={};return this};b.prototype.send=function(a,b){var c={type:this.flags.json?
"json":"message",data:a};"function"==typeof b&&(c.id=++this.ackPackets,c.ack=!0,this.acks[c.id]=b);return this.packet(c)};b.prototype.emit=function(a){var b=Array.prototype.slice.call(arguments,1),c=b[b.length-1],d={type:"event",name:a};"function"==typeof c&&(d.id=++this.ackPackets,d.ack="data",this.acks[d.id]=c,b=b.slice(0,b.length-1));d.args=b;return this.packet(d)};b.prototype.disconnect=function(){""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect"));
return this};b.prototype.onPacket=function(b){function c(){d.packet({type:"ack",args:a.util.toArray(arguments),ackId:b.id})}var d=this;switch(b.type){case "connect":this.$emit("connect");break;case "disconnect":if(""===this.name)this.socket.onDisconnect(b.reason||"booted");else this.$emit("disconnect",b.reason);break;case "message":case "json":var i=["message",b.data];"data"==b.ack?i.push(c):b.ack&&this.packet({type:"ack",ackId:b.id});this.$emit.apply(this,i);break;case "event":i=[b.name].concat(b.args);
"data"==b.ack&&i.push(c);this.$emit.apply(this,i);break;case "ack":this.acks[b.ackId]&&(this.acks[b.ackId].apply(this,b.args),delete this.acks[b.ackId]);break;case "error":if(b.advice)this.socket.onError(b);else"unauthorized"==b.reason?this.$emit("connect_failed",b.reason):this.$emit("error",b.reason)}};c.prototype.send=function(){this.namespace.flags[this.name]=!0;this.namespace.send.apply(this.namespace,arguments)};c.prototype.emit=function(){this.namespace.flags[this.name]=!0;this.namespace.emit.apply(this.namespace,
arguments)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);
(function(d,a,b){function c(b){a.Transport.apply(this,arguments)}d.websocket=c;a.util.inherit(c,a.Transport);c.prototype.name="websocket";c.prototype.open=function(){var c=a.util.query(this.socket.options.query),d=this,e;e||(e=b.MozWebSocket||b.WebSocket);this.websocket=new e(this.prepareUrl()+c);this.websocket.onopen=function(){d.onOpen();d.socket.setBuffer(!1)};this.websocket.onmessage=function(a){d.onData(a.data)};this.websocket.onclose=function(){d.onClose();d.socket.setBuffer(!0)};this.websocket.onerror=
function(a){d.onError(a)};return this};c.prototype.send=function(a){this.websocket.send(a);return this};c.prototype.payload=function(a){for(var b=0,c=a.length;b<c;b++)this.packet(a[b]);return this};c.prototype.close=function(){this.websocket.close();return this};c.prototype.onError=function(a){this.socket.onError(a)};c.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"};c.check=function(){return"WebSocket"in b&&!("__addTask"in WebSocket)||"MozWebSocket"in b};c.xdomainCheck=function(){return!0};
a.transports.push("websocket")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);
(function(d,a){function b(){a.Transport.websocket.apply(this,arguments)}d.flashsocket=b;a.util.inherit(b,a.Transport.websocket);b.prototype.name="flashsocket";b.prototype.open=function(){var b=this,d=arguments;WebSocket.__addTask(function(){a.Transport.websocket.prototype.open.apply(b,d)});return this};b.prototype.send=function(){var b=this,d=arguments;WebSocket.__addTask(function(){a.Transport.websocket.prototype.send.apply(b,d)});return this};b.prototype.close=function(){WebSocket.__tasks.length=
0;a.Transport.websocket.prototype.close.call(this);return this};b.prototype.ready=function(c,d){function h(){var a=c.options,h=a["flash policy port"],g=["http"+(a.secure?"s":"")+":/",a.host+":"+a.port,a.resource,"static/flashsocket","WebSocketMain"+(c.isXDomain()?"Insecure":"")+".swf"];b.loaded||("undefined"===typeof WEB_SOCKET_SWF_LOCATION&&(WEB_SOCKET_SWF_LOCATION=g.join("/")),843!==h&&WebSocket.loadFlashPolicyFile("xmlsocket://"+a.host+":"+h),WebSocket.__initialize(),b.loaded=!0);d.call(e)}var e=
this;if(document.body)return h();a.util.load(h)};b.check=function(){return"undefined"==typeof WebSocket||!("__initialize"in WebSocket)||!swfobject?!1:10<=swfobject.getFlashPlayerVersion().major};b.xdomainCheck=function(){return!0};"undefined"!=typeof window&&(WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0);a.transports.push("flashsocket")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports);
if("undefined"!=typeof window)var swfobject=function(){function d(){if(!z){try{var a=m.getElementsByTagName("body")[0].appendChild(m.createElement("span"));a.parentNode.removeChild(a)}catch(b){return}z=!0;for(var a=D.length,c=0;c<a;c++)D[c]()}}function a(a){z?a():D[D.length]=a}function b(a){if(typeof u.addEventListener!=r)u.addEventListener("load",a,!1);else if(typeof m.addEventListener!=r)m.addEventListener("load",a,!1);else if(typeof u.attachEvent!=r)o(u,"onload",a);else if("function"==typeof u.onload){var b=
u.onload;u.onload=function(){b();a()}}else u.onload=a}function c(){var a=m.getElementsByTagName("body")[0],b=m.createElement(t);b.setAttribute("type",s);var c=a.appendChild(b);if(c){var d=0;(function(){if(typeof c.GetVariable!=r){var e=c.GetVariable("$version");e&&(e=e.split(" ")[1].split(","),k.pv=[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10)])}else if(10>d){d++;setTimeout(arguments.callee,10);return}a.removeChild(b);c=null;f()})()}else f()}function f(){var a=x.length;if(0<a)for(var b=0;b<
a;b++){var c=x[b].id,d=x[b].callbackFn,g={success:!1,id:c};if(0<k.pv[0]){var f=q(c);if(f)if(p(x[b].swfVersion)&&!(k.wk&&312>k.wk))w(c,!0),d&&(g.success=!0,g.ref=h(c),d(g));else if(x[b].expressInstall&&e()){g={};g.data=x[b].expressInstall;g.width=f.getAttribute("width")||"0";g.height=f.getAttribute("height")||"0";f.getAttribute("class")&&(g.styleclass=f.getAttribute("class"));f.getAttribute("align")&&(g.align=f.getAttribute("align"));for(var n={},f=f.getElementsByTagName("param"),l=f.length,m=0;m<
l;m++)"movie"!=f[m].getAttribute("name").toLowerCase()&&(n[f[m].getAttribute("name")]=f[m].getAttribute("value"));i(g,n,c,d)}else j(f),d&&d(g)}else if(w(c,!0),d){if((c=h(c))&&typeof c.SetVariable!=r)g.success=!0,g.ref=c;d(g)}}}function h(a){var b=null;if((a=q(a))&&"OBJECT"==a.nodeName)typeof a.SetVariable!=r?b=a:(a=a.getElementsByTagName(t)[0])&&(b=a);return b}function e(){return!E&&p("6.0.65")&&(k.win||k.mac)&&!(k.wk&&312>k.wk)}function i(a,b,c,d){E=!0;H=d||null;K={success:!1,id:c};var e=q(c);if(e){"OBJECT"==
e.nodeName?(C=g(e),F=null):(C=e,F=c);a.id=M;if(typeof a.width==r||!/%$/.test(a.width)&&310>parseInt(a.width,10))a.width="310";if(typeof a.height==r||!/%$/.test(a.height)&&137>parseInt(a.height,10))a.height="137";m.title=m.title.slice(0,47)+" - Flash Player Installation";d=k.ie&&k.win?["Active"].concat("").join("X"):"PlugIn";d="MMredirectURL="+u.location.toString().replace(/&/g,"%26")+"&MMplayerType="+d+"&MMdoctitle="+m.title;b.flashvars=typeof b.flashvars!=r?b.flashvars+("&"+d):d;k.ie&&k.win&&4!=
e.readyState&&(d=m.createElement("div"),c+="SWFObjectNew",d.setAttribute("id",c),e.parentNode.insertBefore(d,e),e.style.display="none",function(){e.readyState==4?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}());n(a,b,c)}}function j(a){if(k.ie&&k.win&&4!=a.readyState){var b=m.createElement("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(g(a),b);a.style.display="none";(function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)})()}else a.parentNode.replaceChild(g(a),
a)}function g(a){var b=m.createElement("div");if(k.win&&k.ie)b.innerHTML=a.innerHTML;else if(a=a.getElementsByTagName(t)[0])if(a=a.childNodes)for(var c=a.length,d=0;d<c;d++)!(1==a[d].nodeType&&"PARAM"==a[d].nodeName)&&8!=a[d].nodeType&&b.appendChild(a[d].cloneNode(!0));return b}function n(a,b,c){var d,e=q(c);if(k.wk&&312>k.wk)return d;if(e)if(typeof a.id==r&&(a.id=c),k.ie&&k.win){var g="",i;for(i in a)a[i]!=Object.prototype[i]&&("data"==i.toLowerCase()?b.movie=a[i]:"styleclass"==i.toLowerCase()?g+=
' class="'+a[i]+'"':"classid"!=i.toLowerCase()&&(g+=" "+i+'="'+a[i]+'"'));i="";for(var h in b)b[h]!=Object.prototype[h]&&(i+='<param name="'+h+'" value="'+b[h]+'" />');e.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+g+">"+i+"</object>";G[G.length]=a.id;d=q(a.id)}else{h=m.createElement(t);h.setAttribute("type",s);for(var f in a)a[f]!=Object.prototype[f]&&("styleclass"==f.toLowerCase()?h.setAttribute("class",a[f]):"classid"!=f.toLowerCase()&&h.setAttribute(f,a[f]));for(g in b)b[g]!=
Object.prototype[g]&&"movie"!=g.toLowerCase()&&(a=h,i=g,f=b[g],c=m.createElement("param"),c.setAttribute("name",i),c.setAttribute("value",f),a.appendChild(c));e.parentNode.replaceChild(h,e);d=h}return d}function l(a){var b=q(a);b&&"OBJECT"==b.nodeName&&(k.ie&&k.win?(b.style.display="none",function(){if(4==b.readyState){var c=q(a);if(c){for(var d in c)"function"==typeof c[d]&&(c[d]=null);c.parentNode.removeChild(c)}}else setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function q(a){var b=
null;try{b=m.getElementById(a)}catch(c){}return b}function o(a,b,c){a.attachEvent(b,c);B[B.length]=[a,b,c]}function p(a){var b=k.pv,a=a.split(".");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10)||0;a[2]=parseInt(a[2],10)||0;return b[0]>a[0]||b[0]==a[0]&&b[1]>a[1]||b[0]==a[0]&&b[1]==a[1]&&b[2]>=a[2]?!0:!1}function A(a,b,c,d){if(!k.ie||!k.mac){var e=m.getElementsByTagName("head")[0];if(e){c=c&&"string"==typeof c?c:"screen";d&&(I=v=null);if(!v||I!=c)d=m.createElement("style"),d.setAttribute("type","text/css"),
d.setAttribute("media",c),v=e.appendChild(d),k.ie&&k.win&&typeof m.styleSheets!=r&&0<m.styleSheets.length&&(v=m.styleSheets[m.styleSheets.length-1]),I=c;k.ie&&k.win?v&&typeof v.addRule==t&&v.addRule(a,b):v&&typeof m.createTextNode!=r&&v.appendChild(m.createTextNode(a+" {"+b+"}"))}}}function w(a,b){if(O){var c=b?"visible":"hidden";z&&q(a)?q(a).style.visibility=c:A("#"+a,"visibility:"+c)}}function J(a){return null!=/[\\\"<>\.;]/.exec(a)&&typeof encodeURIComponent!=r?encodeURIComponent(a):a}var r="undefined",
t="object",s="application/x-shockwave-flash",M="SWFObjectExprInst",u=window,m=document,y=navigator,P=!1,D=[function(){P?c():f()}],x=[],G=[],B=[],C,F,H,K,z=!1,E=!1,v,I,O=!0,k=function(){var a=typeof m.getElementById!=r&&typeof m.getElementsByTagName!=r&&typeof m.createElement!=r,b=y.userAgent.toLowerCase(),c=y.platform.toLowerCase(),d=c?/win/.test(c):/win/.test(b),c=c?/mac/.test(c):/mac/.test(b),b=/webkit/.test(b)?parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,e=!+"\v1",g=[0,0,0],i=null;
if(typeof y.plugins!=r&&typeof y.plugins["Shockwave Flash"]==t){if((i=y.plugins["Shockwave Flash"].description)&&!(typeof y.mimeTypes!=r&&y.mimeTypes[s]&&!y.mimeTypes[s].enabledPlugin))P=!0,e=!1,i=i.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),g[0]=parseInt(i.replace(/^(.*)\..*$/,"$1"),10),g[1]=parseInt(i.replace(/^.*\.(.*)\s.*$/,"$1"),10),g[2]=/[a-zA-Z]/.test(i)?parseInt(i.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}else if(typeof u[["Active"].concat("Object").join("X")]!=r)try{var h=new (window[["Active"].concat("Object").join("X")])("ShockwaveFlash.ShockwaveFlash");
if(h&&(i=h.GetVariable("$version")))e=!0,i=i.split(" ")[1].split(","),g=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)]}catch(f){}return{w3:a,pv:g,wk:b,ie:e,win:d,mac:c}}();(function(){k.w3&&((typeof m.readyState!=r&&"complete"==m.readyState||typeof m.readyState==r&&(m.getElementsByTagName("body")[0]||m.body))&&d(),z||(typeof m.addEventListener!=r&&m.addEventListener("DOMContentLoaded",d,!1),k.ie&&k.win&&(m.attachEvent("onreadystatechange",function(){"complete"==m.readyState&&(m.detachEvent("onreadystatechange",
arguments.callee),d())}),u==top&&function(){if(!z){try{m.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}d()}}()),k.wk&&function(){z||(/loaded|complete/.test(m.readyState)?d():setTimeout(arguments.callee,0))}(),b(d)))})();(function(){k.ie&&k.win&&window.attachEvent("onunload",function(){for(var a=B.length,b=0;b<a;b++)B[b][0].detachEvent(B[b][1],B[b][2]);a=G.length;for(b=0;b<a;b++)l(G[b]);for(var c in k)k[c]=null;k=null;for(var d in swfobject)swfobject[d]=null;swfobject=
null})})();return{registerObject:function(a,b,c,d){if(k.w3&&a&&b){var e={};e.id=a;e.swfVersion=b;e.expressInstall=c;e.callbackFn=d;x[x.length]=e;w(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(k.w3)return h(a)},embedSWF:function(b,c,d,g,h,f,j,l,m,o){var q={success:!1,id:c};k.w3&&!(k.wk&&312>k.wk)&&b&&c&&d&&g&&h?(w(c,!1),a(function(){d+="";g+="";var a={};if(m&&typeof m===t)for(var k in m)a[k]=m[k];a.data=b;a.width=d;a.height=g;k={};if(l&&typeof l===t)for(var s in l)k[s]=l[s];if(j&&
typeof j===t)for(var u in j)k.flashvars=typeof k.flashvars!=r?k.flashvars+("&"+u+"="+j[u]):u+"="+j[u];if(p(h))s=n(a,k,c),a.id==c&&w(c,!0),q.success=!0,q.ref=s;else{if(f&&e()){a.data=f;i(a,k,c,o);return}w(c,!0)}o&&o(q)})):o&&o(q)},switchOffAutoHideShow:function(){O=!1},ua:k,getFlashPlayerVersion:function(){return{major:k.pv[0],minor:k.pv[1],release:k.pv[2]}},hasFlashPlayerVersion:p,createSWF:function(a,b,c){if(k.w3)return n(a,b,c)},showExpressInstall:function(a,b,c,d){k.w3&&e()&&i(a,b,c,d)},removeSWF:function(a){k.w3&&
l(a)},createCSS:function(a,b,c,d){k.w3&&A(a,b,c,d)},addDomLoadEvent:a,addLoadEvent:b,getQueryParamValue:function(a){var b=m.location.search||m.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);if(null==a)return J(b);for(var b=b.split("&"),c=0;c<b.length;c++)if(b[c].substring(0,b[c].indexOf("="))==a)return J(b[c].substring(b[c].indexOf("=")+1))}return""},expressInstallCallback:function(){if(E){var a=q(M);a&&C&&(a.parentNode.replaceChild(C,a),F&&(w(F,!0),k.ie&&k.win&&(C.style.display="block")),
H&&H(K));E=!1}}}}();
(function(){if(!("undefined"==typeof window||window.WebSocket)){var d=window.console;if(!d||!d.log||!d.error)d={log:function(){},error:function(){}};swfobject.hasFlashPlayerVersion("10.0.0")?("file:"==location.protocol&&d.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(a,b,c,d,h){var e=this;e.__id=WebSocket.__nextId++;WebSocket.__instances[e.__id]=e;e.readyState=WebSocket.CONNECTING;
e.bufferedAmount=0;e.__events={};b?"string"==typeof b&&(b=[b]):b=[];setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(e.__id,a,b,c||null,d||0,h||null)})},0)},WebSocket.prototype.send=function(a){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";a=WebSocket.__flash.send(this.__id,encodeURIComponent(a));if(0>a)return!0;this.bufferedAmount+=a;return!1},WebSocket.prototype.close=function(){this.readyState==WebSocket.CLOSED||
this.readyState==WebSocket.CLOSING||(this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id))},WebSocket.prototype.addEventListener=function(a,b){a in this.__events||(this.__events[a]=[]);this.__events[a].push(b)},WebSocket.prototype.removeEventListener=function(a,b){if(a in this.__events)for(var c=this.__events[a],d=c.length-1;0<=d;--d)if(c[d]===b){c.splice(d,1);break}},WebSocket.prototype.dispatchEvent=function(a){for(var b=this.__events[a.type]||[],c=0;c<b.length;++c)b[c](a);(b=this["on"+
a.type])&&b(a)},WebSocket.prototype.__handleEvent=function(a){"readyState"in a&&(this.readyState=a.readyState);"protocol"in a&&(this.protocol=a.protocol);if("open"==a.type||"error"==a.type)a=this.__createSimpleEvent(a.type);else if("close"==a.type)a=this.__createSimpleEvent("close");else if("message"==a.type)a=this.__createMessageEvent("message",decodeURIComponent(a.message));else throw"unknown event type: "+a.type;this.dispatchEvent(a)},WebSocket.prototype.__createSimpleEvent=function(a){if(document.createEvent&&
window.Event){var b=document.createEvent("Event");b.initEvent(a,!1,!1);return b}return{type:a,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(a,b){if(document.createEvent&&window.MessageEvent&&!window.opera){var c=document.createEvent("MessageEvent");c.initMessageEvent("message",!1,!1,b,null,null,window,null);return c}return{type:a,data:b,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances=
{},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(a){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(a)})},WebSocket.__initialize=function(){if(!WebSocket.__flash)if(WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),window.WEB_SOCKET_SWF_LOCATION){var a=document.createElement("div");a.id="webSocketContainer";a.style.position="absolute";WebSocket.__isFlashLite()?(a.style.left="0px",a.style.top="0px"):(a.style.left=
"-100px",a.style.top="-100px");var b=document.createElement("div");b.id="webSocketFlash";a.appendChild(b);document.body.appendChild(a);swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(a){a.success||d.error("[WebSocket] swfobject.embedSWF failed")})}else d.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf")},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=
document.getElementById("webSocketFlash");WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var a=0;a<WebSocket.__tasks.length;++a)WebSocket.__tasks[a]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){setTimeout(function(){try{for(var a=WebSocket.__flash.receiveEvents(),b=0;b<a.length;++b)WebSocket.__instances[a[b].webSocketId].__handleEvent(a[b])}catch(c){d.error(c)}},0);return!0},WebSocket.__log=function(a){d.log(decodeURIComponent(a))},
WebSocket.__error=function(a){d.error(decodeURIComponent(a))},WebSocket.__addTask=function(a){WebSocket.__flash?a():WebSocket.__tasks.push(a)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var a=window.navigator.mimeTypes["application/x-shockwave-flash"];return!a||!a.enabledPlugin||!a.enabledPlugin.filename?!1:a.enabledPlugin.filename.match(/flashlite/i)?!0:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",
function(){WebSocket.__initialize()},!1):window.attachEvent("onload",function(){WebSocket.__initialize()}))):d.error("Flash Player >= 10.0.0 is required.")}})();
(function(d,a,b){function c(b){b&&(a.Transport.apply(this,arguments),this.sendBuffer=[])}function f(){}d.XHR=c;a.util.inherit(c,a.Transport);c.prototype.open=function(){this.socket.setBuffer(!1);this.onOpen();this.get();this.setCloseTimeout();return this};c.prototype.payload=function(b){for(var c=[],d=0,f=b.length;d<f;d++)c.push(a.parser.encodePacket(b[d]));this.send(a.parser.encodePayload(c))};c.prototype.send=function(a){this.post(a);return this};c.prototype.post=function(a){function c(){if(4==
this.readyState)if(this.onreadystatechange=f,j.posting=!1,200==this.status)j.socket.setBuffer(!1);else j.onClose()}function d(){this.onload=f;j.socket.setBuffer(!1)}var j=this;this.socket.setBuffer(!0);this.sendXHR=this.request("POST");b.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=d:this.sendXHR.onreadystatechange=c;this.sendXHR.send(a)};c.prototype.close=function(){this.onClose();return this};c.prototype.request=function(b){var c=a.util.request(this.socket.isXDomain()),
d=a.util.query(this.socket.options.query,"t="+ +new Date);c.open(b||"GET",this.prepareUrl()+d,!0);if("POST"==b)try{c.setRequestHeader?c.setRequestHeader("Content-type","text/plain;charset=UTF-8"):c.contentType="text/plain"}catch(f){}return c};c.prototype.scheme=function(){return this.socket.options.secure?"https":"http"};c.check=function(c,d){try{var i=a.util.request(d),f=b.XDomainRequest&&i instanceof XDomainRequest,g=(c&&c.options&&c.options.secure?"https:":"http:")!=b.location.protocol;if(i&&(!f||
!g))return!0}catch(n){}return!1};c.xdomainCheck=function(){return c.check(null,!0)}})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);
(function(d,a){function b(b){a.Transport.XHR.apply(this,arguments)}d.htmlfile=b;a.util.inherit(b,a.Transport.XHR);b.prototype.name="htmlfile";b.prototype.get=function(){this.doc=new (window[["Active"].concat("Object").join("X")])("htmlfile");this.doc.open();this.doc.write("<html></html>");this.doc.close();this.doc.parentWindow.s=this;var b=this.doc.createElement("div");b.className="socketio";this.doc.body.appendChild(b);this.iframe=this.doc.createElement("iframe");b.appendChild(this.iframe);var d=
this,b=a.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+b;a.util.on(window,"unload",function(){d.destroy()})};b.prototype._=function(a,b){this.onData(a);try{var d=b.getElementsByTagName("script")[0];d.parentNode.removeChild(d)}catch(e){}};b.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(a){}this.doc=null;this.iframe.parentNode.removeChild(this.iframe);this.iframe=null;CollectGarbage()}};b.prototype.close=function(){this.destroy();
return a.Transport.XHR.prototype.close.call(this)};b.check=function(){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window)try{return new (window[["Active"].concat("Object").join("X")])("htmlfile")&&a.Transport.XHR.check()}catch(b){}return!1};b.xdomainCheck=function(){return!1};a.transports.push("htmlfile")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports);
(function(d,a,b){function c(){a.Transport.XHR.apply(this,arguments)}function f(){}d["xhr-polling"]=c;a.util.inherit(c,a.Transport.XHR);a.util.merge(c,a.Transport.XHR);c.prototype.name="xhr-polling";c.prototype.open=function(){a.Transport.XHR.prototype.open.call(this);return!1};c.prototype.get=function(){function a(){if(4==this.readyState)if(this.onreadystatechange=f,200==this.status)j.onData(this.responseText),j.get();else j.onClose()}function c(){this.onerror=this.onload=f;j.onData(this.responseText);
j.get()}function d(){j.onClose()}if(this.open){var j=this;this.xhr=this.request();b.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=c,this.xhr.onerror=d):this.xhr.onreadystatechange=a;this.xhr.send(null)}};c.prototype.onClose=function(){a.Transport.XHR.prototype.onClose.call(this);if(this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=f;try{this.xhr.abort()}catch(b){}this.xhr=null}};c.prototype.ready=function(b,c){var d=this;a.util.defer(function(){c.call(d)})};
a.transports.push("xhr-polling")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);
(function(d,a,b){function c(b){a.Transport["xhr-polling"].apply(this,arguments);this.index=a.j.length;var c=this;a.j.push(function(a){c._(a)})}var f=b.document&&"MozAppearance"in b.document.documentElement.style;d["jsonp-polling"]=c;a.util.inherit(c,a.Transport["xhr-polling"]);c.prototype.name="jsonp-polling";c.prototype.post=function(b){function c(){d();f.socket.setBuffer(!1)}function d(){f.iframe&&f.form.removeChild(f.iframe);try{o=document.createElement('<iframe name="'+f.iframeId+'">')}catch(a){o=
document.createElement("iframe"),o.name=f.iframeId}o.id=f.iframeId;f.form.appendChild(o);f.iframe=o}var f=this,g=a.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var n=document.createElement("form"),l=document.createElement("textarea"),q=this.iframeId="socketio_iframe_"+this.index,o;n.className="socketio";n.style.position="absolute";n.style.top="0px";n.style.left="0px";n.style.display="none";n.target=q;n.method="POST";n.setAttribute("accept-charset","utf-8");
l.name="d";n.appendChild(l);document.body.appendChild(n);this.form=n;this.area=l}this.form.action=this.prepareUrl()+g;d();this.area.value=a.JSON.stringify(b);try{this.form.submit()}catch(p){}this.iframe.attachEvent?o.onreadystatechange=function(){"complete"==f.iframe.readyState&&c()}:this.iframe.onload=c;this.socket.setBuffer(!0)};c.prototype.get=function(){var b=this,c=document.createElement("script"),d=a.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),
this.script=null);c.async=!0;c.src=this.prepareUrl()+d;c.onerror=function(){b.onClose()};d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d);this.script=c;f&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a);document.body.removeChild(a)},100)};c.prototype._=function(a){this.onData(a);this.open&&this.get();return this};c.prototype.ready=function(b,c){var d=this;if(!f)return c.call(this);a.util.load(function(){c.call(d)})};c.check=function(){return"document"in
b};c.xdomainCheck=function(){return!0};a.transports.push("jsonp-polling")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);var EventDispatcher=function(d){var a={};d.dispatcher={};d.dispatcher.eventListeners={};a.addEventListener=function(a,c){void 0===d.dispatcher.eventListeners[a]&&(d.dispatcher.eventListeners[a]=[]);d.dispatcher.eventListeners[a].push(c)};a.removeEventListener=function(a,c){var f;f=d.dispatcher.eventListeners[a].indexOf(c);-1!==f&&d.dispatcher.eventListeners[a].splice(f,1)};a.dispatchEvent=function(a){var c;L.Logger.debug("Event: "+a.type);for(c in d.dispatcher.eventListeners[a.type])if(d.dispatcher.eventListeners[a.type].hasOwnProperty(c))d.dispatcher.eventListeners[a.type][c](a)};
return a},LynckiaEvent=function(d){var a={};a.type=d.type;return a},RoomEvent=function(d){var a=LynckiaEvent(d);a.streams=d.streams;return a},StreamEvent=function(d){var a=LynckiaEvent(d);a.stream=d.stream;return a},PublisherEvent=function(d){return LynckiaEvent(d)};var Stream=function(d){var a={elementID:void 0};a.streamID=d.streamID;a.stream=d.stream;return a};var Publisher=function(d){var a=EventDispatcher(d);a.room=void 0;a.elementID=void 0;a.hasAudio=function(){return d.audio};a.hasVideo=function(){return d.video};a.init=function(){try{navigator.webkitGetUserMedia({video:d.video,audio:d.audio},function(b){L.Logger.info("User has granted access to local media.");a.stream=Stream({streamID:0,stream:b});void 0!==d.elementID&&(b=new VideoPlayer({id:a.stream.streamID,stream:a.stream.stream,elementID:d.elementID}),a.player=b);b=PublisherEvent({type:"access-accepted"});
a.dispatchEvent(b)},function(a){L.Logger.error("Failed to get access to local media. Error code was "+a.code+".")}),L.Logger.debug("Requested access to local media")}catch(b){L.Logger.error("Error accessing to local media")}};return a};var Room=function(d){var a=EventDispatcher(d),b,c,f,h;a.streams={};a.roomID="";a.socket={};a.state=0;a.addEventListener("room-disconnected",function(b){var c;a.state=0;for(c in a.streams)a.streams.hasOwnProperty(c)&&(b=a.streams[c],h(b),delete a.streams[c],b=StreamEvent({type:"stream-removed",stream:b}),a.dispatchEvent(b));a.streams={};d.publisher.pc.close();d.publisher.pc=void 0;try{a.socket.disconnect()}catch(f){L.Logger.debug("Socket already disconnected")}a.socket=void 0});h=function(a){void 0!==
a.stream&&(a.player.destroy(),a.pc.close())};b=function(b,d,f){a.socket=io.connect("hpcm.dit.upm.es:8080",{reconnect:!1});a.socket.on("onAddStream",function(b){var c=Stream({streamID:b});a.streams[b]=c;b=StreamEvent({type:"stream-added",stream:c});a.dispatchEvent(b)});a.socket.on("onRemoveStream",function(b){var c=a.streams[b];delete a.streams[b];h(c);b=StreamEvent({type:"stream-removed",stream:c});a.dispatchEvent(b)});a.socket.on("disconnect",function(){L.Logger.info("Socket disconnected");var b=
RoomEvent({type:"room-disconnected"});a.dispatchEvent(b)});c("token",b,d,f)};c=function(b,c,d,g){a.socket.emit(b,c,function(a,b){"success"===a?void 0!==d&&d(b):void 0!==g&&g(b)})};f=function(b,c,d,g){a.socket.emit(b,c,d,function(a,b){g(a,b)})};a.connect=function(){0!==a.state&&L.Logger.error("Room already connected");var c=L.Base64.decodeBase64(d.token);a.state=1;b(JSON.parse(c),function(b){var c=0,d=[],e,f;e=b.streams;f=b.id;a.state=0;for(c in e)e.hasOwnProperty(c)&&(b=Stream({streamID:e[c],stream:void 0}),
d.push(b),a.streams[e[c]]=b);a.roomID=f;L.Logger.info("Connected to room "+a.roomID);c=RoomEvent({type:"room-connected",streams:d});a.dispatchEvent(c)},function(a){L.Logger.error("Not Connected! Error: "+a)})};a.disconnect=function(){var b=RoomEvent({type:"room-disconnected"});a.dispatchEvent(b)};a.publish=function(b){d.publisher=b;b.room=a;b.pc=new RoapConnection("STUN stun.l.google.com:19302",function(a){f("publish","offer",a,function(a,c){b.pc.onsignalingmessage=function(a){b.pc.onsignalingmessage=
function(){};f("publish","ok",a);L.Logger.info("Stream published "+a);b.stream.streamID=c};b.pc.processSignalingMessage(a)})});b.pc.addStream(b.stream.stream)};a.unpublish=function(){c("unpublish",void 0)};a.subscribe=function(a,b){a.elementID=b;a.pc=new RoapConnection("STUN stun.l.google.com:19302",function(b){f("subscribe",a.streamID,b,function(b){a.pc.processSignalingMessage(b)})});a.pc.onaddstream=function(c){L.Logger.info("Stream subscribed");a.stream=c.stream;c=new VideoPlayer({id:a.streamID,
stream:a.stream,elementID:b});a.player=c};L.Logger.info("Subscribing to: "+a.streamID)};a.unsubscribe=function(b){void 0!==a.socket?c("unsubscribe",b.streamID,function(){h(b)},function(){L.Logger.error("Error calling unsubscribe.")}):callback()};return a};var L=L||{};
L.Logger=function(d){return{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5,enableLogPanel:function(){d.Logger.panel=document.createElement("textarea");d.Logger.panel.setAttribute("id","lynckia-logs");d.Logger.panel.setAttribute("style","width: 100%; height: 100%; display: none");d.Logger.panel.setAttribute("rows",20);d.Logger.panel.setAttribute("cols",20);d.Logger.panel.setAttribute("readOnly",!0);document.body.appendChild(d.Logger.panel)},setLogLevel:function(a){a>d.Logger.NONE?a=d.Logger.NONE:a<
d.Logger.DEBUG&&(a=d.Logger.DEBUG);d.Logger.logLevel=a},log:function(a,b){var c="";a<d.Logger.logLevel||(a===d.Logger.DEBUG?c+="DEBUG":a===d.Logger.TRACE?c+="TRACE":a===d.Logger.INFO?c+="INFO":a===d.Logger.WARNING?c+="WARNING":a===d.Logger.ERROR&&(c+="ERROR"),c=c+": "+b,void 0!==d.Logger.panel?d.Logger.panel.value=d.Logger.panel.value+"\n"+c:console.log(c))},debug:function(a){d.Logger.log(d.Logger.DEBUG,a)},trace:function(a){d.Logger.log(d.Logger.TRACE,a)},info:function(a){d.Logger.log(d.Logger.INFO,
a)},warning:function(a){d.Logger.log(d.Logger.WARNING,a)},error:function(a){d.Logger.log(d.Logger.ERROR,a)}}}(L);L=L||{};
L.Base64=function(){var d,a,b,c,f,h,e,i,j;d="A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,0,1,2,3,4,5,6,7,8,9,+,/".split(",");a=[];for(f=0;f<d.length;f+=1)a[d[f]]=f;h=function(a){b=a;c=0};e=function(){var a;if(!b||c>=b.length)return-1;a=b.charCodeAt(c)&255;c+=1;return a};i=function(){if(!b)return-1;for(;;){if(c>=b.length)return-1;var d=b.charAt(c);c+=1;if(a[d])return a[d];if("A"===d)return 0}};j=function(a){a=a.toString(16);1===a.length&&(a=
"0"+a);return unescape("%"+a)};return{encodeBase64:function(a){var b,c,f;h(a);a="";b=Array(3);c=0;for(f=!1;!f&&-1!==(b[0]=e());)if(b[1]=e(),b[2]=e(),a+=d[b[0]>>2],-1!==b[1]?(a+=d[b[0]<<4&48|b[1]>>4],-1!==b[2]?(a+=d[b[1]<<2&60|b[2]>>6],a+=d[b[2]&63]):(a+=d[b[1]<<2&60],a+="=",f=!0)):(a+=d[b[0]<<4&48],a+="=",a+="=",f=!0),c+=4,76<=c)a+="\n",c=0;return a},decodeBase64:function(a){var b,c;h(a);a="";b=Array(4);for(c=!1;!c&&-1!==(b[0]=i())&&-1!==(b[1]=i());)b[2]=i(),b[3]=i(),a+=j(b[0]<<2&255|b[1]>>4),-1!==
b[2]?(a+=j(b[1]<<4&255|b[2]>>2),-1!==b[3]?a+=j(b[2]<<6&255|b[3]):c=!0):c=!0;return a}}}(L);var VideoPlayer=function(d){var a={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(a,c,d){document.getElementById(c).value=unescape(d)});a.destroy=function(){a.video.pause();a.parentNode.removeChild(a.div)};a.id=d.id;a.stream=d.stream;a.elementID=d.elementID;L.Logger.debug("Creating URL from stream "+a.stream);a.url=webkitURL.createObjectURL(a.stream);a.div=document.createElement("div");a.div.setAttribute("id","player_"+a.id);a.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black");
a.loader=document.createElement("img");a.loader.setAttribute("style","width: 16px; height: 16px; position: absolute; top: 50%; left: 50%; margin-top: -8px; margin-left: -8px");a.loader.setAttribute("id","back_"+a.id);a.loader.setAttribute("src","http://hpcm.dit.upm.es/assets/loader.gif");a.video=document.createElement("video");a.video.setAttribute("id","stream"+a.id);a.video.setAttribute("style","width: 100%; height: 100%; position: absolute");a.video.setAttribute("autoplay","autoplay");void 0!==
a.elementID?document.getElementById(a.elementID).appendChild(a.div):document.body.appendChild(a.div);a.parentNode=a.div.parentNode;a.div.appendChild(a.loader);a.div.appendChild(a.video);a.bar=new Bar({elementID:"player_"+a.id,id:a.id,video:a.video});a.div.onmouseover=function(){a.bar.display()};a.div.onmouseout=function(){a.bar.hide()};a.video.src=a.url;return a};var Bar=function(d){var a=EventDispatcher({});a.elementID=d.elementID;a.id=d.id;var b=void 0;a.div=document.createElement("div");a.div.setAttribute("id","bar_"+a.id);a.bar=document.createElement("div");a.bar.setAttribute("style","width: 100%; height: 32px; position: absolute; bottom: 0; right: 0; background-color: rgba(255,255,255,0.62)");a.bar.setAttribute("id","subbar_"+a.id);a.logo=document.createElement("img");a.logo.setAttribute("style","width: 32px; height: 32px; position: absolute; top: 0; left: 0;");
a.logo.setAttribute("src","http://hpcm.dit.upm.es/assets/star.svg");var c=function(c){"block"!==c?c="none":clearTimeout(b);a.div.setAttribute("style","width: 100%; height: 100%; position: relative; bottom: 0; right: 0; display:"+c)};a.display=function(){c("block")};a.hide=function(){b=setTimeout(c,1E3)};console.log(a.elementID);document.getElementById(a.elementID).appendChild(a.div);a.div.appendChild(a.bar);a.bar.appendChild(a.logo);a.speaker=new Speaker({elementID:"bar_"+a.id,id:a.id,video:d.video});
a.display();a.hide();return a};var Speaker=function(d){var a=EventDispatcher({});a.elementID=d.elementID;a.video=d.video;a.id=d.id;a.div=document.createElement("div");a.div.setAttribute("style","width: 32px; height: 32px; position: absolute; bottom: 0; right: 0;");a.icon=document.createElement("img");a.icon.setAttribute("id","volume_"+a.id);a.icon.setAttribute("src","http://hpcm.dit.upm.es/assets/mute48.png");a.icon.setAttribute("style","width: 32px; height: 32px; position: absolute;");a.div.appendChild(a.icon);a.picker=document.createElement("input");
a.picker.setAttribute("id","picker_"+a.id);a.picker.type="range";a.picker.min=0;a.picker.max=100;a.picker.step=10;a.picker.value=50;a.div.appendChild(a.picker);a.video=a.picker.value;a.picker.oninput=function(){0<a.picker.value?a.icon.setAttribute("src","http://hpcm.dit.upm.es/assets/sound48.png"):a.icon.setAttribute("src","http://hpcm.dit.upm.es/assets/mute48.png");a.video=a.picker.value};var b=function(b){a.picker.setAttribute("style","width: 32px; height: 100px; position: absolute; bottom: 30px; right: 0px; -webkit-appearance: slider-vertical; display: "+
b)};b("none");a.div.onmouseover=function(){b("block")};a.div.onmouseout=function(){b("none")};document.getElementById(a.elementID).appendChild(a.div);return a};
