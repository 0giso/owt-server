var CryptoJS=CryptoJS||function(c,f){var h={},a=h.lib={},d=a.Base=function(){function e(){}return{extend:function(j){e.prototype=this;var b=new e;j&&b.mixIn(j);b.$super=this;return b},create:function(){var e=this.extend();e.init.apply(e,arguments);return e},init:function(){},mixIn:function(e){for(var b in e)e.hasOwnProperty(b)&&(this[b]=e[b]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.$super.extend(this)}}}(),n=a.WordArray=d.extend({init:function(e,b){e=
this.words=e||[];this.sigBytes=b!=f?b:4*e.length},toString:function(e){return(e||i).stringify(this)},concat:function(e){var b=this.words,a=e.words,g=this.sigBytes,e=e.sigBytes;this.clamp();if(g%4)for(var c=0;c<e;c++)b[g+c>>>2]|=(a[c>>>2]>>>24-8*(c%4)&255)<<24-8*((g+c)%4);else if(65535<a.length)for(c=0;c<e;c+=4)b[g+c>>>2]=a[c>>>2];else b.push.apply(b,a);this.sigBytes+=e;return this},clamp:function(){var e=this.words,b=this.sigBytes;e[b>>>2]&=4294967295<<32-8*(b%4);e.length=c.ceil(b/4)},clone:function(){var e=
d.clone.call(this);e.words=this.words.slice(0);return e},random:function(e){for(var b=[],a=0;a<e;a+=4)b.push(4294967296*c.random()|0);return n.create(b,e)}}),l=h.enc={},i=l.Hex={stringify:function(e){for(var b=e.words,e=e.sigBytes,a=[],g=0;g<e;g++){var c=b[g>>>2]>>>24-8*(g%4)&255;a.push((c>>>4).toString(16));a.push((c&15).toString(16))}return a.join("")},parse:function(e){for(var b=e.length,a=[],g=0;g<b;g+=2)a[g>>>3]|=parseInt(e.substr(g,2),16)<<24-4*(g%8);return n.create(a,b/2)}},m=l.Latin1={stringify:function(b){for(var a=
b.words,b=b.sigBytes,g=[],c=0;c<b;c++)g.push(String.fromCharCode(a[c>>>2]>>>24-8*(c%4)&255));return g.join("")},parse:function(b){for(var a=b.length,g=[],c=0;c<a;c++)g[c>>>2]|=(b.charCodeAt(c)&255)<<24-8*(c%4);return n.create(g,a)}},b=l.Utf8={stringify:function(b){try{return decodeURIComponent(escape(m.stringify(b)))}catch(a){throw Error("Malformed UTF-8 data");}},parse:function(b){return m.parse(unescape(encodeURIComponent(b)))}},g=a.BufferedBlockAlgorithm=d.extend({reset:function(){this._data=n.create();
this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=b.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(b){var a=this._data,g=a.words,d=a.sigBytes,i=this.blockSize,h=d/(4*i),h=b?c.ceil(h):c.max((h|0)-this._minBufferSize,0),b=h*i,d=c.min(4*b,d);if(b){for(var f=0;f<b;f+=i)this._doProcessBlock(g,f);f=g.splice(0,b);a.sigBytes-=d}return n.create(f,d)},clone:function(){var b=d.clone.call(this);b._data=this._data.clone();return b},_minBufferSize:0});a.Hasher=g.extend({init:function(){this.reset()},
reset:function(){g.reset.call(this);this._doReset()},update:function(b){this._append(b);this._process();return this},finalize:function(b){b&&this._append(b);this._doFinalize();return this._hash},clone:function(){var b=g.clone.call(this);b._hash=this._hash.clone();return b},blockSize:16,_createHelper:function(b){return function(a,g){return b.create(g).finalize(a)}},_createHmacHelper:function(b){return function(a,g){return o.HMAC.create(b,g).finalize(a)}}});var o=h.algo={};return h}(Math);
(function(){var c=CryptoJS,f=c.lib,h=f.WordArray,f=f.Hasher,a=[],d=c.algo.SHA1=f.extend({_doReset:function(){this._hash=h.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(c,d){for(var i=this._hash.words,h=i[0],b=i[1],g=i[2],f=i[3],e=i[4],j=0;80>j;j++){if(16>j)a[j]=c[d+j]|0;else{var k=a[j-3]^a[j-8]^a[j-14]^a[j-16];a[j]=k<<1|k>>>31}k=(h<<5|h>>>27)+e+a[j];k=20>j?k+((b&g|~b&f)+1518500249):40>j?k+((b^g^f)+1859775393):60>j?k+((b&g|b&f|g&f)-1894007588):k+((b^g^f)-
899497514);e=f;f=g;g=b<<30|b>>>2;b=h;h=k}i[0]=i[0]+h|0;i[1]=i[1]+b|0;i[2]=i[2]+g|0;i[3]=i[3]+f|0;i[4]=i[4]+e|0},_doFinalize:function(){var a=this._data,c=a.words,d=8*this._nDataBytes,f=8*a.sigBytes;c[f>>>5]|=128<<24-f%32;c[(f+64>>>9<<4)+15]=d;a.sigBytes=4*c.length;this._process()}});c.SHA1=f._createHelper(d);c.HmacSHA1=f._createHmacHelper(d)})();
(function(){var c=CryptoJS,f=c.enc.Utf8;c.algo.HMAC=c.lib.Base.extend({init:function(c,a){c=this._hasher=c.create();"string"==typeof a&&(a=f.parse(a));var d=c.blockSize,n=4*d;a.sigBytes>n&&(a=c.finalize(a));for(var l=this._oKey=a.clone(),i=this._iKey=a.clone(),m=l.words,b=i.words,g=0;g<d;g++)m[g]^=1549556828,b[g]^=909522486;l.sigBytes=i.sigBytes=n;this.reset()},reset:function(){var c=this._hasher;c.reset();c.update(this._iKey)},update:function(c){this._hasher.update(c);return this},finalize:function(c){var a=
this._hasher,c=a.finalize(c);a.reset();return a.finalize(this._oKey.clone().concat(c))}})})();var N=N||{};N.authors=["aalonsog@dit.upm.es","prodriguez@dit.upm.es","jcervino@dit.upm.es"];N.version=0.1;N=N||{};
N.Base64=function(){var c,f,h,a,d,n,l,i,m;c="A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,0,1,2,3,4,5,6,7,8,9,+,/".split(",");f=[];for(d=0;d<c.length;d+=1)f[c[d]]=d;n=function(b){h=b;a=0};l=function(){var b;if(!h||a>=h.length)return-1;b=h.charCodeAt(a)&255;a+=1;return b};i=function(){if(!h)return-1;for(;;){if(a>=h.length)return-1;var b=h.charAt(a);a+=1;if(f[b])return f[b];if("A"===b)return 0}};m=function(b){b=b.toString(16);1===b.length&&(b=
"0"+b);return unescape("%"+b)};return{encodeBase64:function(b){var a,d,e;n(b);b="";a=Array(3);d=0;for(e=!1;!e&&-1!==(a[0]=l());)if(a[1]=l(),a[2]=l(),b+=c[a[0]>>2],-1!==a[1]?(b+=c[a[0]<<4&48|a[1]>>4],-1!==a[2]?(b+=c[a[1]<<2&60|a[2]>>6],b+=c[a[2]&63]):(b+=c[a[1]<<2&60],b+="=",e=!0)):(b+=c[a[0]<<4&48],b+="=",b+="=",e=!0),d+=4,76<=d)b+="\n",d=0;return b},decodeBase64:function(b){var a,c;n(b);b="";a=Array(4);for(c=!1;!c&&-1!==(a[0]=i())&&-1!==(a[1]=i());)a[2]=i(),a[3]=i(),b+=m(a[0]<<2&255|a[1]>>4),-1!==
a[2]?(b+=m(a[1]<<4&255|a[2]>>2),-1!==a[3]?b+=m(a[2]<<6&255|a[3]):c=!0):c=!0;return b}}}(N);N=N||{};
N.API=function(c){var f,h;f=function(a,d,f,l,i,m){var b,g,o,e,j,k;b=c.API.params.service;g=c.API.params.key;""===b||""===g?console.log("ServiceID and Key are required!!"):(o=(new Date).getTime(),e=o+",123123aaff",j="MAuth realm=http://marte3.dit.upm.es,mauth_signature_method=HMAC_SHA1",""!==i&&""!==m&&(j=j+",mauth_username="+i+",mauth_role="+m,e+=","+i+","+m),i=h(e,g),j=j+",mauth_serviceid="+b+",mauth_cnonce=123123aaff,mauth_timestamp="+o+",mauth_signature="+i,k=new XMLHttpRequest,k.onreadystatechange=function(){k.readyState===
4&&a(k.responseText)},k.open(d,l,!0),k.setRequestHeader("Authorization",j),k.setRequestHeader("Content-Type","application/json"),console.log("Sending "+d+" to "+l),k.send(JSON.stringify(f)))};h=function(a,d){var f;f=CryptoJS.HmacSHA1(a,d).toString(CryptoJS.enc.Hex);return c.Base64.encodeBase64(f)};return{params:{url:void 0,service:void 0,key:void 0},init:function(a,d,f){c.API.params.url=a;c.API.params.service=d;c.API.params.key=f},createRoom:function(a,d){f(d,"POST",a,c.API.params.url+"rooms")},getRooms:function(a){f(a,
"GET",void 0,c.API.params.url+"rooms")},deleteRoom:function(a,d){f(d,"DELETE",void 0,c.API.params.url+"rooms/"+a)},createToken:function(a,d,h,l){f(l,"POST",void 0,c.API.params.url+"rooms/"+a+"/tokens",d,h)},createService:function(a,d,h){f(h,"POST",{name:a,key:d},c.API.params.url+"services/")},getServices:function(a){f(a,"GET",void 0,c.API.params.url+"services/")},getService:function(a,d){f(d,"GET",void 0,c.API.params.url+"services/"+a)},deleteService:function(a,d){f(d,"DELETE",void 0,c.API.params.url+
"services/"+a)},getUsers:function(a,d){f(d,"GET",void 0,c.API.params.url+"rooms/"+a+"/users/")},getUser:function(a,d,h){f(h,"GET",void 0,c.API.params.url+"rooms/"+a+"/users/"+d)},deleteUser:function(a,d,h){f(h,"DELETE",void 0,c.API.params.url+"rooms/"+a+"/users/"+d)}}}(N);
